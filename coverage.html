
<!DOCTYPE html>
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
		<title>completion: Go Coverage Report</title>
		<style>
			body {
				background: black;
				color: rgb(80, 80, 80);
			}
			body, pre, #legend span {
				font-family: Menlo, monospace;
				font-weight: bold;
			}
			#topbar {
				background: black;
				position: fixed;
				top: 0; left: 0; right: 0;
				height: 42px;
				border-bottom: 1px solid rgb(80, 80, 80);
			}
			#content {
				margin-top: 50px;
			}
			#nav, #legend {
				float: left;
				margin-left: 10px;
			}
			#legend {
				margin-top: 12px;
			}
			#nav {
				margin-top: 10px;
			}
			#legend span {
				margin: 0 5px;
			}
			.cov0 { color: rgb(192, 0, 0) }
.cov1 { color: rgb(128, 128, 128) }
.cov2 { color: rgb(116, 140, 131) }
.cov3 { color: rgb(104, 152, 134) }
.cov4 { color: rgb(92, 164, 137) }
.cov5 { color: rgb(80, 176, 140) }
.cov6 { color: rgb(68, 188, 143) }
.cov7 { color: rgb(56, 200, 146) }
.cov8 { color: rgb(44, 212, 149) }
.cov9 { color: rgb(32, 224, 152) }
.cov10 { color: rgb(20, 236, 155) }

		</style>
	</head>
	<body>
		<div id="topbar">
			<div id="nav">
				<select id="files">
				
				<option value="file0">dsh/internal/completion/renderer.go (87.7%)</option>
				
				<option value="file1">dsh/internal/completion/types.go (100.0%)</option>
				
				</select>
			</div>
			<div id="legend">
				<span>not tracked</span>
			
				<span class="cov0">not covered</span>
				<span class="cov8">covered</span>
			
			</div>
		</div>
		<div id="content">
		
		<pre class="file" id="file0" style="display: none">// Package completion provides terminal-based completion menu rendering functionality.
package completion

import (
        "strings"

        "dsh/internal/terminal"
)

// Renderer handles the visual display of completion menus with proper buffer management.
type Renderer struct {
        terminal terminal.TerminalInterface
}

// NewRenderer creates a new menu renderer.
func NewRenderer(term terminal.TerminalInterface) *Renderer <span class="cov8" title="1">{
        return &amp;Renderer{
                terminal: term,
        }
}</span>

// Render displays the completion menu with proper cursor management.
func (r *Renderer) Render(menu *Menu) <span class="cov8" title="1">{
        if !menu.IsDisplayed() || !menu.HasItems() </span><span class="cov8" title="1">{
                return
        }</span>

        // Save cursor position before rendering
        <span class="cov8" title="1">r.terminal.SaveCursor()

        itemWidth, cols, maxRows, itemsPerPage := r.calculateLayout(menu)
        totalPages := (len(menu.items) + itemsPerPage - 1) / itemsPerPage

        // Adjust page if selection moved
        selectedPage := menu.selected / itemsPerPage
        if selectedPage != menu.page </span><span class="cov0" title="0">{
                menu.page = selectedPage
        }</span>

        // Calculate items to show on current page
        <span class="cov8" title="1">startIdx := menu.page * itemsPerPage
        endIdx := startIdx + itemsPerPage
        if endIdx &gt; len(menu.items) </span><span class="cov8" title="1">{
                endIdx = len(menu.items)
        }</span>

        <span class="cov8" title="1">pageItems := menu.items[startIdx:endIdx]

        // Move to next line to start rendering
        _, _ = r.terminal.WriteString("\r\n")

        // Display items in grid
        linesUsed := 0
        for i := range maxRows </span><span class="cov8" title="1">{
                for j := range cols </span><span class="cov8" title="1">{
                        idx := i*cols + j
                        if idx &gt;= len(pageItems) </span><span class="cov8" title="1">{
                                break</span>
                        }

                        <span class="cov8" title="1">item := pageItems[idx]
                        globalIdx := startIdx + idx
                        text := item.Text

                        var displayText string
                        if globalIdx == menu.selected </span><span class="cov8" title="1">{
                                displayText = r.terminal.StyleText(text, terminal.Style{Reverse: true})
                        }</span> else<span class="cov8" title="1"> {
                                switch item.Type </span>{
                                case "builtin":<span class="cov8" title="1">
                                        displayText = r.terminal.Colorize(text, terminal.ColorCyan)</span>
                                case "command":<span class="cov8" title="1">
                                        displayText = r.terminal.Colorize(text, terminal.ColorGreen)</span>
                                case "directory":<span class="cov8" title="1">
                                        displayText = r.terminal.Colorize(text, terminal.ColorBlue)</span>
                                default:<span class="cov0" title="0">
                                        displayText = text</span>
                                }
                        }

                        <span class="cov8" title="1">padding := itemWidth - len(text)
                        _, _ = r.terminal.WriteString(displayText + strings.Repeat(" ", padding))</span>
                }
                <span class="cov8" title="1">_, _ = r.terminal.WriteString("\r\n")
                linesUsed++</span>
        }

        // Show pagination info
        <span class="cov8" title="1">if totalPages &gt; 1 </span><span class="cov0" title="0">{
                pageInfo := "Page " + string(rune(menu.page+1+'0')) + "/" + string(rune(totalPages+'0'))
                _, _ = r.terminal.WriteString(r.terminal.Colorize(pageInfo, terminal.ColorBrightBlack) + "\r\n")
                linesUsed++
        }</span>

        // Store lines used for cleanup
        <span class="cov8" title="1">menu.linesDrawn = linesUsed

        // Mark menu as displayed
        menu.displayed = true</span>
}

// Clear removes the completion menu from display with proper cleanup.
func (r *Renderer) Clear(menu *Menu) <span class="cov8" title="1">{
        if !menu.displayed </span><span class="cov0" title="0">{
                return
        }</span>

        // Clear from cursor to end of screen
        <span class="cov8" title="1">r.terminal.ClearFromCursor()

        // Restore cursor to original position
        r.terminal.RestoreCursor()

        // Mark menu as not displayed
        menu.displayed = false
        menu.linesDrawn = 0</span>
}

// calculateLayout calculates the layout parameters for the menu.
func (r *Renderer) calculateLayout(menu *Menu) (itemWidth, cols, maxRows, itemsPerPage int) <span class="cov8" title="1">{
        width, height := r.terminal.Size()
        maxItemWidth := 0

        // Find max item width
        for _, item := range menu.items </span><span class="cov8" title="1">{
                if len(item.Text) &gt; maxItemWidth </span><span class="cov8" title="1">{
                        maxItemWidth = len(item.Text)
                }</span>
        }

        <span class="cov8" title="1">itemWidth = maxItemWidth + 2
        cols = width / itemWidth
        if cols &lt; 1 </span><span class="cov0" title="0">{
                cols = 1
        }</span>

        // Calculate available rows
        <span class="cov8" title="1">availableRows := height - 5
        if availableRows &lt; 3 </span><span class="cov0" title="0">{
                availableRows = 3
        }</span>

        <span class="cov8" title="1">maxRows = availableRows
        if maxRows &gt; menu.maxRows </span><span class="cov8" title="1">{
                maxRows = menu.maxRows
        }</span>

        <span class="cov8" title="1">itemsPerPage = maxRows * cols
        return itemWidth, cols, maxRows, itemsPerPage</span>
}
</pre>
		
		<pre class="file" id="file1" style="display: none">package completion

// Item represents a completion with its type.
type Item struct {
        Text string
        Type string // "builtin", "command", "file", "directory"
}

// Menu handles the display and navigation of completion options.
type Menu struct {
        items      []Item
        selected   int
        displayed  bool
        linesDrawn int
        maxRows    int
        page       int
        base       string
}

// NewMenu creates a new completion menu.
func NewMenu() *Menu <span class="cov8" title="1">{
        return &amp;Menu{
                maxRows: 10,
        }
}</span>

// Show displays the completion menu with the given items.
func (m *Menu) Show(items []Item, base string) <span class="cov8" title="1">{
        m.items = items
        m.base = base
        m.selected = 0
        m.displayed = true
        m.page = 0
}</span>

// Hide clears the completion menu.
func (m *Menu) Hide() <span class="cov8" title="1">{
        m.displayed = false
        m.items = nil
        m.selected = 0
        m.linesDrawn = 0
}</span>

// IsDisplayed returns whether the menu is currently shown.
func (m *Menu) IsDisplayed() bool <span class="cov8" title="1">{
        return m.displayed
}</span>

// GetSelected returns the currently selected item.
func (m *Menu) GetSelected() (Item, bool) <span class="cov8" title="1">{
        if !m.displayed || m.selected &gt;= len(m.items) </span><span class="cov8" title="1">{
                return Item{}, false
        }</span>
        <span class="cov8" title="1">return m.items[m.selected], true</span>
}

// GetBase returns the completion base string.
func (m *Menu) GetBase() string <span class="cov8" title="1">{
        return m.base
}</span>

// NextItem moves selection to the next item.
func (m *Menu) NextItem() <span class="cov8" title="1">{
        if len(m.items) &gt; 0 </span><span class="cov8" title="1">{
                m.selected = (m.selected + 1) % len(m.items)
        }</span>
}

// PrevItem moves selection to the previous item.
func (m *Menu) PrevItem() <span class="cov8" title="1">{
        if len(m.items) &gt; 0 </span><span class="cov8" title="1">{
                m.selected = (m.selected - 1 + len(m.items)) % len(m.items)
        }</span>
}

// HasItems returns whether the menu has any items.
func (m *Menu) HasItems() bool <span class="cov8" title="1">{
        return len(m.items) &gt; 0
}</span>
</pre>
		
		</div>
	</body>
	<script>
	(function() {
		var files = document.getElementById('files');
		var visible;
		files.addEventListener('change', onChange, false);
		function select(part) {
			if (visible)
				visible.style.display = 'none';
			visible = document.getElementById(part);
			if (!visible)
				return;
			files.value = part;
			visible.style.display = 'block';
			location.hash = part;
		}
		function onChange() {
			select(files.value);
			window.scrollTo(0, 0);
		}
		if (location.hash != "") {
			select(location.hash.substr(1));
		}
		if (!visible) {
			select("file0");
		}
	})();
	</script>
</html>
